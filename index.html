<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S-01 Kundenverwaltung – Mindmap</title>
  <style>
    :root {
      --bg: #f7f9fc;
      --card: #ffffff;
      --border: #e5e7eb;
      --text: #1f2937;
      --muted: #4b5563;
      --general: #1f2937;
      --p1: #4f46e5;
      --p2: #059669;
      --p3: #f59e0b;
      --p4: #e11d48;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: radial-gradient(circle at 20% 20%, #f2f5ff 0%, #f7f9fc 35%, #eef2ff 100%);
      color: var(--text);
    }
    .page {
      min-height: 100vh;
      padding: 32px;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 24px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(15, 23, 42, 0.08);
      padding: 24px;
    }
    h1 { margin: 0 0 8px 0; font-size: 28px; }
    p.lead { margin: 0 0 16px 0; color: var(--muted); }
    .legend { display: flex; flex-wrap: wrap; gap: 12px; }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--text); }
    .pill { height: 10px; width: 40px; border-radius: 999px; border: 1px solid rgba(0,0,0,0.08); }
    .p1 { background: var(--p1); color: #fff; border-color: #312e81; }
    .p2 { background: var(--p2); color: #fff; border-color: #065f46; }
    .p3 { background: var(--p3); color: #111827; border-color: #d97706; }
    .p4 { background: var(--p4); color: #fff; border-color: #9f1239; }
    .general { background: #1f2937; color: #fff; border-color: #0f172a; }
    .node-wrap { margin-left: 0; }
    .node { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; }
    .node-box {
      padding: 10px 14px;
      border-radius: 12px;
      border: 2px solid transparent;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
      max-width: 720px;
    }
    .node-title { font-weight: 700; line-height: 1.2; }
    .node-meta { margin: 4px 0 0 0; font-size: 12px; opacity: 0.9; line-height: 1.4; }
    .children { border-left: 2px solid var(--border); margin-left: 18px; padding-left: 16px; }
    .toggle { cursor: pointer; border: none; background: transparent; font-size: 16px; line-height: 1; padding: 4px; color: var(--muted); }
    .bullet { width: 6px; height: 6px; border-radius: 50%; background: #9ca3af; margin-top: 9px; }
    .hint { font-size: 14px; color: var(--muted); line-height: 1.5; }
    .assignment-item, .timeline-item { padding: 8px 12px; margin: 6px 0; border-radius: 8px; cursor: pointer; transition: opacity 0.2s; }
    .assignment-item:hover, .timeline-item:hover { opacity: 0.85; }
    .assignment-a { background: linear-gradient(135deg, rgba(79, 70, 229, 0.12), rgba(79, 70, 229, 0.06)); border-left: 3px solid var(--p1); }
    .assignment-b { background: linear-gradient(135deg, rgba(5, 150, 105, 0.12), rgba(5, 150, 105, 0.06)); border-left: 3px solid var(--p2); }
    .assignment-c { background: linear-gradient(135deg, rgba(245, 158, 11, 0.12), rgba(245, 158, 11, 0.06)); border-left: 3px solid var(--p3); }
    .assignment-d { background: linear-gradient(135deg, rgba(225, 29, 72, 0.12), rgba(225, 29, 72, 0.06)); border-left: 3px solid var(--p4); }
    .timeline-kw50 { background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), rgba(34, 197, 94, 0.04)); border-left: 3px solid #86efac; }
    .timeline-kw51 { background: linear-gradient(135deg, rgba(34, 197, 94, 0.14), rgba(34, 197, 94, 0.07)); border-left: 3px solid #4ade80; }
    .timeline-kw52 { background: linear-gradient(135deg, rgba(34, 197, 94, 0.20), rgba(34, 197, 94, 0.10)); border-left: 3px solid #22c55e; }
    .timeline-kw01 { background: linear-gradient(135deg, rgba(34, 197, 94, 0.26), rgba(34, 197, 94, 0.13)); border-left: 3px solid #16a34a; }
    .timeline-kw02 { background: linear-gradient(135deg, rgba(34, 197, 94, 0.32), rgba(34, 197, 94, 0.16)); border-left: 3px solid #15803d; }
    .timeline-kw03 { background: linear-gradient(135deg, rgba(34, 197, 94, 0.38), rgba(34, 197, 94, 0.19)); border-left: 3px solid #166534; }
    .timeline-kw04 { background: linear-gradient(135deg, rgba(34, 197, 94, 0.44), rgba(34, 197, 94, 0.22)); border-left: 3px solid #14532d; }
    @media (max-width: 720px) {
      .page { padding: 18px; }
      h1 { font-size: 22px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="container">
      <div class="card">
        <h1>S-01 Kundenverwaltung – Mindmap</h1>
        <p class="lead">Online-Ticket-Shop | Pflichtäste: Use Cases · Objekte und Attribute · Schnittstellen</p>
        <div class="legend" id="legend"></div>
      </div>

      <div class="card" id="mindmap"></div>

      <div class="card">
        <h2 style="margin:0 0 8px 0; font-size:20px;">Vorschlag Aufgabenteilung (4 Personen)</h2>
        <ul style="margin:0; padding:0; list-style:none; line-height:1.5; color:var(--text);">
          <li class="assignment-item assignment-a" data-targets="Registrierung & Login|Profil & Kontaktdaten|Zahlungsarten & Validierung|Bewertungen & Berechtigungen|Premium-Status & Reservierungen/Warenkorb"><strong>Person A – Use Cases & Stories:</strong> Registrierung/Login, Profil/Kontakt, Zahlungsarten inkl. Premium-Rechnung, Premium-Upgrade, Bewertungsberechtigung; Artefakte: User Stories, UC-Spezifikationen, Akzeptanzkriterien, Aktivitätsdiagramme (VL3, VL6, VL9).</li>
          <li class="assignment-item assignment-b" data-targets="Domänenmodell – Objekte & Attribute"><strong>Person B – Domänenmodell:</strong> Kunde, Profil, Zahlungsarten, Berechtigungs-/Historienobjekte, Ableitungen (reservierungsdauer, warenkorbTimeout); Artefakte: UML-Klassendiagramm mit Attributtabellen/Enums/Operationen (VL7/8).</li>
          <li class="assignment-item assignment-c" data-targets="Dynamik & Regeln"><strong>Person C – Dynamik & Regeln:</strong> Passwort-Policy/Sperrlogik, Payment-Validierung, Premium-Upgrade-Folgen, Bewertungs-Guards, digitale Bereitstellung; Artefakte: Aktivitäts-/Sequenzdiagramme mit Guards/Decisions (VL9, Bezug VL6).</li>
          <li class="assignment-item assignment-d" data-targets="Schnittstellen & Segmente"><strong>Person D – Schnittstellen & Segmente:</strong> Verträge zu S-02/S-03/S-04/S-05/S-06/S-09 (externe Gruppen), Parameterübergaben (Premium-Flag, Reservierungsdauer, Timeouts), externe Payment-Adapter; Artefakte: Schnittstellenverträge/Context-Map/Parametertabellen (VL10).</li>
        </ul>
      </div>

      <div class="card">
        <h2 style="margin:0 0 8px 0; font-size:20px;">Timeline bis 25.01.2026</h2>
        <ul style="margin:0; padding:0; list-style:none; line-height:1.6; color:var(--text);">
          <li class="timeline-item timeline-kw50" data-targets="Registrierung & Login|Profil & Kontaktdaten|Zahlungsarten & Validierung"><strong>KW 50 (09.12–15.12):</strong> User Stories & UC-Spezifikationen für Registrierung/Login, Profil, Zahlungsarten; Passwort-Policy-Checkliste; erste Aktivitätsdiagramme (Schnittstellen zu Gruppen S-09, S-03).</li>
          <li class="timeline-item timeline-kw51" data-targets="Domänenmodell – Objekte & Attribute"><strong>KW 51 (16.12–22.12):</strong> Domänenmodell (Kunde, Profil, Zahlungsarten, Berechtigungen, Ableitungen); Attributtabellen/Enums; Review mit Use-Case-Flows.</li>
          <li class="timeline-item timeline-kw52" data-targets="Dynamik & Regeln"><strong>KW 52 (23.12–29.12):</strong> Dynamik/Regeln ausarbeiten: Sperrlogik, Payment-Validierung, Premium-Upgrade-Folgen, Bewertungs-Guards, digitale Bereitstellung; Aktivitäts-/Sequenzdiagramme.</li>
          <li class="timeline-item timeline-kw01" data-targets="Schnittstellen & Segmente"><strong>KW 01 (30.12–05.01):</strong> Schnittstellenverträge zu externen Gruppen S-02/S-03/S-04/S-05/S-06/S-09 inkl. Parameter (Premium-Flag, Reservierungsdauer, Timeouts); Kontextskizze.</li>
          <li class="timeline-item timeline-kw02" data-targets="Premium-Status & Reservierungen/Warenkorb|Bewertungen & Berechtigungen|Domänenmodell – Objekte & Attribute"><strong>KW 02 (06.01–12.01):</strong> Konsolidierung: Trace zwischen UCs, Domänenmodell, Regeln, Schnittstellen; Parametertabellen (Reservierung/Warenkorb zu S-02/S-06) finalisieren; Lücken schließen.</li>
          <li class="timeline-item timeline-kw03" data-targets="Registrierung & Login|Digitale Ticketbereitstellung|Schnittstellen & Segmente"><strong>KW 03 (13.01–19.01):</strong> Qualitätssicherung: Peer-Reviews der Diagramme/Verträge; Konsistenz-Check gegen Vorgaben (S-04 digital only, S-05 Kaufnachweis, S-09 Sperre 3x/1h).</li>
          <li class="timeline-item timeline-kw04" data-targets="Registrierung & Login|Profil & Kontaktdaten|Zahlungsarten & Validierung|Premium-Status & Reservierungen/Warenkorb|Bewertungen & Berechtigungen|Digitale Ticketbereitstellung|Domänenmodell – Objekte & Attribute|Dynamik & Regeln|Schnittstellen & Segmente"><strong>KW 04 (20.01–25.01):</strong> Finalisierung & Puffer: letzte Anpassungen, Export/Packaging aller Artefakte; Abnahme-Checkliste und Präsentationsfolien erstellen (Ende: 25.01.2026).</li>
        </ul>
      </div>

      <div class="card">
        <h2 style="margin:0 0 8px 0; font-size:20px;">Hinweis</h2>
        <p class="hint">
          Die Mindmap folgt den geforderten Hauptästen und deckt alle S-01-relevanten Anforderungen ab: Registrierung mit Passwort-Policy und Sperrlogik,
          Profil- und Zahlungsdatenpflege inkl. Premium-Logik, Reservierungs- und Warenkorb-Zeiten, Bewertungsberechtigung, ausschließlich digitale
          Ticketbereitstellung sowie die notwendigen Schnittstellen zu den Segmenten S-02, S-03, S-04, S-05, S-06 und S-09.
        </p>
      </div>
    </div>
  </div>

  <script>
    const nodeIndex = new Map(); // label -> { toggle, childContainer }
    const parentIndex = new Map(); // label -> parent label

    const roleStyles = {
      general: 'general',
      p1: 'p1',
      p2: 'p2',
      p3: 'p3',
      p4: 'p4'
    };

    const legend = [
      { role: 'general', label: 'Aufgabestellung / Neutral' },
      { role: 'p1', label: 'Use Cases & Stories' },
      { role: 'p2', label: 'Objekte & Attribute' },
      { role: 'p3', label: 'Dynamik & Regeln' },
      { role: 'p4', label: 'Schnittstellen & Segmente' }
    ];

    const mindMapData = {
      label: 'S-01 Kundenverwaltung – Aufgabestellung und Personenverantwortung',
      role: 'general',
      meta: 'Fachliche Gliederung der Anforderungen; Format: Mindmap (HTML/JS); Tool: Browser/VS Code; Vorlesung: VL1 – Einführung & Projektrahmen',
      children: [
        {
          label: 'Registrierung & Login',
          role: 'p1',
          meta: 'Stories, UC-Flows, Passwort-Policy, Sperrlogik; Schnittstelle zu S-09 (Login/Passwort-Management); Format: User Stories + UC-Spezifikation + Aktivitätsdiagramm; Tools: Markdown/Jira + draw.io; Vorlesung: VL3 – Agiles Vorgehen & User Stories, VL6 – Use Cases & UC-Spezifikation, VL9 – Aktivitäts- & Sequenzdiagramme',
          children: [
            { label: 'Als Besucher möchte ich mich registrieren, um Tickets kaufen zu können.', role: 'p1', meta: 'Story sauber formulieren, Akteur+Nutzen klar; Akzeptanzkriterien aus Passwortpolicy ableiten; Format: User Story + Akzeptanzkriterien (Text); Tool: Markdown/Jira; Vorlesung: VL3 – Agiles Vorgehen & User Stories.' },
            { label: 'Passwortregeln (Komplexität, doppelte Eingabe); Sperre nach 3 Fehlversuchen', role: 'p3', meta: 'In den UC-Flow aufnehmen; Fehlversuchszähler und Lockout als Schritte modellieren; Format: Use-Case-Spezifikation (Text) + Aktivitätsdiagramm; Tool: Markdown + draw.io; Vorlesung: VL6 – Use Cases & UC-Spezifikation; Bezug: VL3 – Agiles Vorgehen & User Stories.' },
            { label: 'Login für Warenkorb/Käufe nutzen', role: 'p1', meta: 'UC inkl. Preconditions (Account aktiv) und Postconditions (Session offen) beschreiben; Format: Use-Case-Spezifikation (Text); Tool: Markdown; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' },
            { label: 'Nach Sperrfrist wieder Zugriff erhalten', role: 'p1', meta: 'Flow für Entsperren definieren; Zeitfenster 1h berücksichtigen; alternative Pfade dokumentieren; Format: Use-Case-Spezifikation (Text) + Aktivitätsdiagramm; Tool: Markdown + draw.io; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' }
          ]
        },
        {
          label: 'Profil & Kontaktdaten',
          role: 'p1',
          meta: 'Adresse, Kontaktpräferenzen, digitale Zustellung; Format: Use-Case-Spezifikation; Tool: Markdown; Vorlesung: VL6 – Use Cases & UC-Spezifikation',
          children: [
            { label: 'Liefer- und Rechnungsadresse, Kontaktdaten aktualisieren', role: 'p1', meta: 'UC mit Validierungen (E-Mail-Format, Pflichtfelder) und rein digitalen Zustellwegen formulieren; Format: Use-Case-Spezifikation (Text); Tool: Markdown; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' }
          ]
        },
        {
          label: 'Zahlungsarten & Validierung',
          role: 'p1',
          meta: 'Zahlarten, Premium-Rechnung, Validierung IBAN/BIC/Luhn/Token; Schnittstelle zu S-03 (Bezahlung); Format: UC-Spezifikation + Aktivitätsdiagramm; Tools: Markdown + draw.io; Vorlesung: VL6 – Use Cases, VL10 – Architektur & Schnittstellen',
          children: [
            { label: 'Zahlungsarten: Vorkasse, Kreditkarte, PayPal, Bankeinzug', role: 'p1', meta: 'UC-Flows pro Zahlart skizzieren; Eingabefehlerpfade aufnehmen; Format: Use-Case-Spezifikation (Text); Tool: Markdown; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' },
            { label: 'Premium: zusätzlich Rechnung/Überweisung', role: 'p1', meta: 'Premium-Guard in UC verankern; Abhängigkeit zum Status beschreiben; Format: Use-Case-Spezifikation (Text); Tool: Markdown; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' },
            { label: 'Validierung aller Zahlungsdaten zwingend (IBAN/BIC/Luhn, Token, Mandat)', role: 'p3', meta: 'Akzeptanzkriterien für Validität definieren; Fehler-Responses festlegen; Format: Use-Case-Spezifikation (Text) + Aktivitätsdiagramm Payment; Tool: Markdown + draw.io; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' }
          ]
        },
        {
          label: 'Premium-Status & Reservierungen/Warenkorb',
          role: 'p1',
          meta: 'Premium-Upgrade, Reservierungsdauer 2h/4h, Warenkorb-Timeout 24h/36h; Schnittstellen zu S-02 (Sitzplatzauswahl) und S-06 (Warenkorb); Format: UC-Spezifikation + Parametertabelle; Tools: Markdown/Excel; Vorlesung: VL6 – Use Cases, VL10 – Architektur & Schnittstellen',
          children: [
            { label: 'Upgrade auf Premium für 4h Reservierung + zusätzliche Zahlungsart', role: 'p1', meta: 'UC mit Trigger, Preconditions (zahlungsfaehig), Postconditions (Status=Premium) beschreiben; Format: Use-Case-Spezifikation (Text); Tool: Markdown; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' },
            { label: 'Reservierungsdauer und Warenkorb-Timeout übergeben', role: 'p3', meta: 'Schnittstellen-Calls als Schritte im UC aufführen; Parameter benennen (an externe Gruppen S-02 Sitzplatzauswahl, S-06 Warenkorb); Format: Use-Case-Spezifikation (Text) + Schnittstellen-Call-Liste; Tool: Markdown; Vorlesung: VL10 – Architektur & Schnittstellen.' }
          ]
        },
        {
          label: 'Bewertungen & Berechtigungen',
          role: 'p1',
          meta: 'Kaufnachweis + Terminende als Guard; Schnittstelle zu S-05 (Kundenbewertung); Format: UC-Spezifikation + Aktivitätsdiagramm; Tools: Markdown + draw.io; Vorlesung: VL6 – Use Cases, VL9 – Aktivitätsdiagramme',
          children: [
            { label: 'Bewerten nur für gekaufte Artikel nach Terminende', role: 'p1', meta: 'UC mit Guard „Artikel gekauft + Termin vorbei“; Ausnahmen dokumentieren; Format: Use-Case-Spezifikation (Text); Tool: Markdown; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' },
            { label: 'System prüft Kaufnachweis und Datum; Shop-Bewertungen ausgeschlossen', role: 'p3', meta: 'Interaktion mit externer Gruppe S-05 (Kundenbewertung) als Include/Extend modellieren; Negativpfade beschreiben; Format: Use-Case-Spezifikation (Text) + Aktivitätsdiagramm; Tool: Markdown + draw.io; Vorlesung: VL6 – Use Cases & UC-Spezifikation.' }
          ]
        },
        {
          label: 'Digitale Ticketbereitstellung',
          role: 'general',
          meta: 'Nur E-Mail/Download/QR, keine Papierlieferung; Schnittstelle zu S-04 (Ticketbereitstellung); Format: Architektur-/Kontextnotiz; Tool: Markdown; Vorlesung: VL4 – Geschäftsprozesse & Segmente',
          children: []
        },
        {
          label: 'Domänenmodell – Objekte & Attribute',
          role: 'p2',
          meta: 'Klassendiagramm, Datenstruktur, Ableitungen; Format: UML-Klassendiagramm + Attribute-Tabellen; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II',
          children: [
            {
              label: 'Kunde (zentral)',
              role: 'p2',
              meta: 'IDs als String; Status & Premium-Flag; Format: UML-Klassendiagramm; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II',
              children: [
                { label: 'kundennr, benutzername, email', role: 'p2', meta: 'IDs als String; Eindeutigkeit für benutzername sicherstellen; Format: UML-Klassendiagramm + Attributtabelle; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' },
                { label: 'passwortHash, fehlversuche, gesperrtBis', role: 'p2', meta: 'Attribute für Sperrlogik vorsehen; Typen präzisieren (datetime); Format: UML-Klassendiagramm; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' },
                { label: 'status: Neu/Aktiv/Gesperrt/Deaktiviert; premium: boolean', role: 'p2', meta: 'Enum definieren; Premium-Flag konsistent zu Ableitungen halten; Format: UML-Klassendiagramm + Enum-Tabelle; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' }
              ]
            },
            {
              label: 'Kundenprofil',
              role: 'p2',
              children: [
                { label: 'lieferadresse, rechnungsadresse, telefon', role: 'p2', meta: '1:1 zum Kunden; Pflichtfelder markieren; nur digitale Zustellung bedenken; Format: UML-Klassendiagramm; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' },
                { label: 'kontaktPraeferenz: Email/Telefon', role: 'p2', meta: 'Enum modellieren; Default Email; Validierung auf erlaubte Werte; Format: UML-Klassendiagramm + Enum-Tabelle; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' }
              ]
            },
            {
              label: 'Zahlungsart',
              role: 'p2',
              children: [
                { label: 'typ: Vorkasse/Kreditkarte/PayPal/Bankeinzug/RechnungPremium', role: 'p2', meta: 'Enum inkl. Premium-only Wert; Constraints je Typ festhalten; Format: UML-Klassendiagramm + Enum; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' },
                { label: 'iban, bic, kartenToken, paypalToken', role: 'p2', meta: 'Attribute nur für relevante Typen befüllen; Kardinalitäten dokumentieren; Format: UML-Klassendiagramm + Attributliste; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' },
                { label: 'mandatsReferenz, gueltigBis', role: 'p2', meta: 'Für SEPA erfassen; Datumstyp setzen; Pflicht nur bei Bankeinzug; Format: UML-Klassendiagramm; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' }
              ]
            },
            {
              label: 'Berechtigung / Historie',
              role: 'p2',
              children: [
                { label: 'gekaufteArtikel: list<string> (Bewertungsrecht)', role: 'p2', meta: 'Liste für Berechtigungsprüfung (S-05); Persistenzform überlegen; Format: UML-Klassendiagramm + Attributliste; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' },
                { label: 'letzterLogin, registriertAm', role: 'p2', meta: 'Audit-Attribute; Datentypen präzisieren; optional/null festhalten; Format: UML-Klassendiagramm; Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' }
              ]
            },
            {
              label: 'Ableitungen',
              role: 'p2',
              children: [
                { label: 'reservierungsdauer(): 2h / 4h je Premium', role: 'p2', meta: 'Operation mit Rückgabetyp Duration modellieren; nutzt premium-Flag; Format: UML-Klassendiagramm (Operation); Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' },
                { label: 'warenkorbTimeout(): 24h / 36h je Premium', role: 'p2', meta: 'Operation für S-06; Werte als Konstante oder Konfiguration halten; Format: UML-Klassendiagramm (Operation); Tool: draw.io; Vorlesung: VL7/8 – UML-Klassendiagramme I/II.' }
              ]
            }
          ]
        },
        {
          label: 'Dynamik & Regeln',
          role: 'p3',
          meta: 'Sequenzen, Guards, Policies; Format: Aktivitäts- und Sequenzdiagramme (UML); Tool: draw.io; Vorlesung: VL9 – Aktivitäts- & Sequenzdiagramme',
          children: [
            { label: 'Passwort-Policy erzwingen (Komplexität, Doppel-Eingabe, Sperre 3x/1h)', role: 'p3', meta: 'In Sequenz- und Aktivitätsdiagrammen als Guard/Decision modellieren; Format: Aktivitäts-/Sequenzdiagramm; Tool: draw.io; Vorlesung: VL9 – Aktivitäts- & Sequenzdiagramme; Bezug: VL6 – Use Cases & UC-Spezifikation.' },
            { label: 'Premium-Upgrade schaltet Rechnung + längere Reservierungen frei', role: 'p3', meta: 'Statuswechsel zeigen; Folgeschritte in S-02/S-06 markieren; Alternativpfad bei Fehlschlag; Format: Aktivitäts-/Sequenzdiagramm; Tool: draw.io; Vorlesung: VL9 – Aktivitäts- & Sequenzdiagramme.' },
            { label: 'Bewertungen nur für gekaufte Artikel und erst nach Terminende', role: 'p3', meta: 'Guard mit Termin- und Kaufprüfung; Fehlpfad skizzieren; Format: Aktivitätsdiagramm; Tool: draw.io; Vorlesung: VL9 – Aktivitäts- & Sequenzdiagramme.' },
            { label: 'Digitale Bereitstellung: Tickets nur per E-Mail/Download/QR', role: 'p3', meta: 'Aktivität für Übergabe an S-04 modellieren; keine Papierzweige darstellen; Format: Aktivitätsdiagramm; Tool: draw.io; Vorlesung: VL9 – Aktivitäts- & Sequenzdiagramme.' }
          ]
        },
        {
          label: 'Schnittstellen & Segmente',
          role: 'p4',
          meta: 'Segmente S-02..S-09 und externe Payment-Provider; Format: Schnittstellenvertrag/Context-Map (Tabelle/Text); Tool: Markdown/Excel; Vorlesung: VL10 – Architektur & Schnittstellen',
          children: [
            { label: 'Schnittstelle zu Login & Passwortmanagement (S-09)', role: 'p4', meta: 'Schnittstelle zur externen Gruppe S-09 definieren: Authentifizierung, Sperrstatus/Passwortregeln konsumieren und liefern; Format: Schnittstellenvertrag (Text/Tabelle); Tool: Markdown/Excel; Vorlesung: VL10 – Architektur & Schnittstellen.' },
            { label: 'Schnittstelle zu Bezahlung (S-03)', role: 'p4', meta: 'API/Port zur externen Gruppe S-03 spezifizieren: Zahlungsarten, PaymentMethod-Liste mit Validierungsflags ausgeben; Format: Schnittstellenvertrag (Text/Tabelle); Tool: Markdown/Excel; Vorlesung: VL10 – Architektur & Schnittstellen.' },
            { label: 'Schnittstelle zu Warenkorb (S-06)', role: 'p4', meta: 'Datenvertrag zur externen Gruppe S-06: Kundentyp (Premium/Standard), Timeout 24h/36h, premium-Flag, Berechtigungsstatus liefern; Format: Schnittstellenvertrag; Tool: Markdown/Excel; Vorlesung: VL10 – Architektur & Schnittstellen.' },
            { label: 'Schnittstelle zu Sitzplatzauswahl (S-02)', role: 'p4', meta: 'Reservierungsdauer 2h/4h als Parameter an externe Gruppe S-02 übergeben; Quelle ist reservierungsdauer()-Ableitung; Format: Schnittstellenvertrag; Tool: Markdown/Excel; Vorlesung: VL10 – Architektur & Schnittstellen.' },
            { label: 'Schnittstelle zu Kundenbewertung (S-05)', role: 'p4', meta: 'Berechtigungsservice für externe Gruppe S-05: Kaufnachweis + Terminprüfung (hatGekauft, terminVorbei) bereitstellen; Format: Schnittstellenvertrag; Tool: Markdown/Excel; Vorlesung: VL10 – Architektur & Schnittstellen.' },
            { label: 'Schnittstelle zu Ticketbereitstellung (S-04)', role: 'p4', meta: 'Lieferkanal zur externen Gruppe S-04 definieren (E-Mail/Account als Übergabepunkt für Download und QR-Code); nur digitale Medien modellieren; Format: Schnittstellenvertrag + Kontextskizze; Tool: Markdown/draw.io; Vorlesung: VL10 – Architektur & Schnittstellen.' },
            { label: 'Externe Zahlungsanbieter: PayPal-Token, Karten-Token, SEPA-Mandat verwalten', role: 'p4', meta: 'Adapter/Ports ausarbeiten; Token-Speicherung und Mandatsstatus bereitstellen; Format: Schnittstellenvertrag; Tool: Markdown/Excel; Vorlesung: VL10 – Architektur & Schnittstellen.' }
          ]
        }
      ]
    };

    const mindmapContainer = document.getElementById('mindmap');
    const legendContainer = document.getElementById('legend');

    function renderLegend() {
      legend.forEach(item => {
        const el = document.createElement('div');
        el.className = 'legend-item';
        const pill = document.createElement('span');
        pill.className = `pill ${roleStyles[item.role]}`;
        const label = document.createElement('span');
        label.textContent = item.label;
        el.appendChild(pill);
        el.appendChild(label);
        legendContainer.appendChild(el);
      });
    }

    function createNode(node, level = 0, parentLabel = null) {
      const wrap = document.createElement('div');
      wrap.className = 'node-wrap';

      const row = document.createElement('div');
      row.className = 'node';

      const hasChildren = node.children && node.children.length > 0;

      if (hasChildren) {
        const btn = document.createElement('button');
        btn.className = 'toggle';
        btn.textContent = level < 1 ? '▾' : '▸';
        btn.setAttribute('aria-label', level < 1 ? 'Einklappen' : 'Ausklappen');
        row.appendChild(btn);

        const box = document.createElement('div');
        box.className = `node-box ${roleStyles[node.role] || 'general'}`;
        const title = document.createElement('div');
        title.className = 'node-title';
        title.textContent = node.label;
        box.appendChild(title);
        if (node.meta) {
          const meta = document.createElement('div');
          meta.className = 'node-meta';
          meta.textContent = node.meta;
          box.appendChild(meta);
        }
        row.appendChild(box);
        wrap.appendChild(row);

        const childContainer = document.createElement('div');
        childContainer.className = 'children';
        childContainer.style.display = level < 1 ? 'block' : 'none';
        node.children.forEach((child) => childContainer.appendChild(createNode(child, level + 1, node.label)));
        wrap.appendChild(childContainer);

        nodeIndex.set(node.label, { toggle: btn, childContainer });

        btn.addEventListener('click', () => {
          const isOpen = childContainer.style.display !== 'none';
          childContainer.style.display = isOpen ? 'none' : 'block';
          btn.textContent = isOpen ? '▸' : '▾';
          btn.setAttribute('aria-label', isOpen ? 'Ausklappen' : 'Einklappen');
        });
      } else {
        const bullet = document.createElement('div');
        bullet.className = 'bullet';
        row.appendChild(bullet);

        const box = document.createElement('div');
        box.className = `node-box ${roleStyles[node.role] || 'general'}`;
        const title = document.createElement('div');
        title.className = 'node-title';
        title.textContent = node.label;
        box.appendChild(title);
        if (node.meta) {
          const meta = document.createElement('div');
          meta.className = 'node-meta';
          meta.textContent = node.meta;
          box.appendChild(meta);
        }
        row.appendChild(box);
        wrap.appendChild(row);

        nodeIndex.set(node.label, {});
      }

      parentIndex.set(node.label, parentLabel);
      return wrap;
    }

    function renderMindmap() {
      mindmapContainer.innerHTML = '';
      nodeIndex.clear();
      parentIndex.clear();
      mindmapContainer.appendChild(createNode(mindMapData));
    }

    renderLegend();
    renderMindmap();

    function expandLabel(label) {
      if (!parentIndex.has(label) && label !== mindMapData.label) return;
      const entrySelf = nodeIndex.get(label);
      if (entrySelf && entrySelf.childContainer) {
        entrySelf.childContainer.style.display = 'block';
        if (entrySelf.toggle) {
          entrySelf.toggle.textContent = '▾';
          entrySelf.toggle.setAttribute('aria-label', 'Einklappen');
        }
      }
      let current = label;
      while (current) {
        const parent = parentIndex.get(current);
        if (parent) {
          const entry = nodeIndex.get(parent);
          if (entry && entry.childContainer) {
            entry.childContainer.style.display = 'block';
            if (entry.toggle) {
              entry.toggle.textContent = '▾';
              entry.toggle.setAttribute('aria-label', 'Einklappen');
            }
          }
        }
        current = parent;
      }
    }

    function attachInteractions() {
      const clickables = document.querySelectorAll('[data-targets]');
      clickables.forEach((el) => {
        el.style.cursor = 'pointer';
        el.addEventListener('click', () => {
          const targets = (el.getAttribute('data-targets') || '').split('|').map(t => t.trim()).filter(Boolean);
          targets.forEach(expandLabel);
        });
      });
    }

    attachInteractions();
  </script>
</body>
</html>
